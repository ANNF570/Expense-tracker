<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Spendora ‚Äì Login</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="style.css">

    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#111133" />

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

    <style>
        /* Extra styles only for password visibility */
        
        .password-wrapper {
            position: relative;
        }
        
        .toggle-pass {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            opacity: 0.75;
            font-size: 18px;
            user-select: none;
        }
        
        .toggle-pass:hover {
            opacity: 1;
        }
        /* Center logo above card */
        
        .logo-big {
            width: 140px;
            display: block;
            margin: 0 auto 18px auto;
            filter: drop-shadow(0 0 12px #00f0ff55);
        }
    </style>
    <!-- Firebase init for LOGIN page only -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAXu1FJ0VhjM0XxYIfs7KLDx1Chh1tDBfw",
            authDomain: "expense-tracker-akif-832fb.firebaseapp.com",
            projectId: "expense-tracker-akif-832fb",
            storageBucket: "expense-tracker-akif-832fb.firebasestorage.app",
            messagingSenderId: "846826483222",
            appId: "1:846826483222:web:2fcc5d66100a14c6fc0f37",
            measurementId: "G-ZSM3KCK8RF"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        // these are what your doLogin/doSignup use üëá
        const auth = firebase.auth();
        const db = firebase.firestore();
    </script>

</head>

<body>
    <div class="auth-wrap">
        <div class="card auth-card">


            <!-- OUR Spendora Logo -->
            <img src="assets/full_logo.png" class="logo-big" alt="Spendora Logo">

            <!-- THEME TOGGLE -->
            <div id="themeToggle" class="theme-toggle">
                <div class="theme-thumb"></div>

                <button class="theme-toggle-btn" data-theme="light">‚òÄÔ∏è</button>
                <button class="theme-toggle-btn" data-theme="neon">SP</button>
                <button class="theme-toggle-btn" data-theme="dark">üåô</button>
            </div>



            <!-- LOGIN VIEW -->
            <div id="loginView">
                <h1 style="text-align:center;margin-bottom:6px;">Spendora</h1>
                <div style="opacity:0.8;text-align:center;margin-bottom:22px;">Smart Expense Tracking</div>

                <input id="log-email" class="input" type="email" placeholder="Email">

                <div class="password-wrapper">
                    <input id="log-pass" class="input" type="password" placeholder="Password">
                    <span class="toggle-pass" onclick="togglePassword('log-pass', this)">üëÅÔ∏è</span>
                </div>

                <button class="btn" onclick="doLogin()">Login</button>

                <div class="small" style="margin-top:12px;">
                    Create account? <a href="#" onclick="showSignup()">Signup</a>
                </div>
            </div>

            <!-- SIGNUP VIEW -->
            <div id="signupView" style="display:none;">
                <h1 style="text-align:center;margin-bottom:6px;">Spendora</h1>
                <div style="opacity:0.8;text-align:center;margin-bottom:22px;">Create your account</div>

                <input id="su-email" class="input" type="email" placeholder="Email">

                <div class="password-wrapper">
                    <input id="su-pass" class="input" type="password" placeholder="Password (min 6)">
                    <span class="toggle-pass" onclick="togglePassword('su-pass', this)">üëÅÔ∏è</span>
                </div>

                <button class="btn" onclick="doSignup()">Signup</button>

                <div class="small" style="margin-top:12px;">
                    Already have account? <a href="#" onclick="showLogin()">Login</a>
                </div>
            </div>

            <!-- Google Login -->
            <div class="google-btn" onclick="googleLogin()">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" style="width:22px;margin-right:8px;"> Continue with Google
            </div>

        </div>
    </div>

    <!-- Firebase Init -->
    <script>
        // Show / Hide Password
        function togglePassword(id, el) {
            const input = document.getElementById(id);

            if (input.type === "password") {
                input.type = "text";
                el.textContent = "üôà";
            } else {
                input.type = "password";
                el.textContent = "üëÅÔ∏è";
            }
        }
    </script>
    <script>
        // ==== LOGIN & SIGNUP (Works only on index.html) ====

        function showSignup() {
            document.getElementById("loginView").style.display = "none";
            document.getElementById("signupView").style.display = "block";
        }

        function showLogin() {
            document.getElementById("signupView").style.display = "none";
            document.getElementById("loginView").style.display = "block";
        }

        async function doSignup() {
            const email = document.getElementById("su-email").value.trim();
            const pass = document.getElementById("su-pass").value.trim();

            if (!email || pass.length < 6) {
                alert("Enter a valid email & password (min 6 chars)");
                return;
            }

            try {
                const userCred = await auth.createUserWithEmailAndPassword(email, pass);

                await db.collection("users").doc(userCred.user.uid).set({
                    email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                window.location.href = "dashboard.html";
            } catch (err) {
                alert(err.message);
            }
        }

        async function doLogin() {
            const email = document.getElementById("log-email").value.trim();
            const pass = document.getElementById("log-pass").value.trim();

            try {
                await auth.signInWithEmailAndPassword(email, pass);
                window.location.href = "dashboard.html";
            } catch (err) {
                alert(err.message);
            }
        }

        async function googleLogin() {
            const provider = new firebase.auth.GoogleAuthProvider();
            try {
                const res = await auth.signInWithPopup(provider);
                const user = res.user;

                const ref = db.collection("users").doc(user.uid);
                const snap = await ref.get();

                if (!snap.exists) {
                    await ref.set({
                        email: user.email,
                        name: user.displayName || "",
                        photo: user.photoURL || "",
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }

                window.location.href = "dashboard.html";
            } catch (err) {
                alert(err.message);
            }
        }
    </script>

    <!-- Theme logic (shared) -->
    <script src="theme.js"></script>

    <script src="app.js"></script>

</body>

</html>